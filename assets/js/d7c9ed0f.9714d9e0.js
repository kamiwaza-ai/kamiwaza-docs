"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[841],{3345:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>s,metadata:()=>o,toc:()=>c});var i=t(4848),r=t(8453);const s={},a="Starting Ray",o={type:"mdx",permalink:"/kamiwaza-docs/ray",source:"@site/src/pages/ray.md",title:"Starting Ray",description:"Ray is a powerful distributed computing framework that Kamiwaza uses for various tasks. This guide will help you start Ray using the provided script, and has some information about caveats using Kamiwaza with your existing ray cluster.",frontMatter:{},unlisted:!1},l={},c=[{value:"Using the start-ray.sh Script",id:"using-the-start-raysh-script",level:2},{value:"Connecting to an Existing Ray Cluster",id:"connecting-to-an-existing-ray-cluster",level:2},{value:"Customizing Ray Configuration",id:"customizing-ray-configuration",level:2}];function h(n){const e={code:"code",h1:"h1",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.h1,{id:"starting-ray",children:"Starting Ray"}),"\n",(0,i.jsx)(e.p,{children:"Ray is a powerful distributed computing framework that Kamiwaza uses for various tasks. This guide will help you start Ray using the provided script, and has some information about caveats using Kamiwaza with your existing ray cluster."}),"\n",(0,i.jsx)(e.h2,{id:"using-the-start-raysh-script",children:"Using the start-ray.sh Script"}),"\n",(0,i.jsxs)(e.p,{children:["The easiest way to start Ray is by using the ",(0,i.jsx)(e.code,{children:"start-ray.sh"})," script provided with Kamiwaza. This script automatically configures Ray based on your system's capabilities and environment variables."]}),"\n",(0,i.jsx)(e.p,{children:"To use the script:"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Open a terminal and navigate to your Kamiwaza directory."}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Run the following command:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"./start-ray.sh\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"The script will:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Activate the virtual environment"}),"\n",(0,i.jsx)(e.li,{children:"Set necessary environment variables"}),"\n",(0,i.jsx)(e.li,{children:"Determine the number of CPUs and GPUs available"}),"\n",(0,i.jsx)(e.li,{children:"Start Ray with appropriate parameters"}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"connecting-to-an-existing-ray-cluster",children:"Connecting to an Existing Ray Cluster"}),"\n",(0,i.jsx)(e.p,{children:"If you have an existing Ray cluster and want to connect to it from your Kamiwaza application, you'll need to set up the connection manually in your code. Here's how you can do it:"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"Ensure you're in your Kamiwaza virtual environment:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"source venv/bin/activate\n"})}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"In your Python code, import Ray and set up the runtime environment:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:'import os\nimport ray\nfrom ray import serve\n\n# Set the PROTOCOL_BUFFERS_PYTHON_IMPLEMENTATION environment variable\nos.environ["PROTOCOL_BUFFERS_PYTHON_IMPLEMENTATION"] = "python"\n\n# Set up the runtime environment\nruntime_env = {\n    "env_vars": {\n        "PROTOCOL_BUFFERS_PYTHON_IMPLEMENTATION": "python"\n    }\n}\n\n# Initialize Ray with the runtime environment\nray.init(runtime_env=runtime_env)\n\n'})}),"\n",(0,i.jsxs)(e.p,{children:["This approach ensures that the ",(0,i.jsx)(e.code,{children:"PROTOCOL_BUFFERS_PYTHON_IMPLEMENTATION"})," environment variable is set for all Ray workers called from that code"]}),"\n",(0,i.jsxs)(e.p,{children:["Note that this is generally ",(0,i.jsx)(e.strong,{children:"not needed"})," for Kamiwaza itself to run properly, as Kamiwaza will set the appropriate ",(0,i.jsx)(e.code,{children:"runtime_env"})," settings; however, if you are, for example, importing kamiwaza into a Jupyter notebook which then taps into ray functionality, then you may need to use this technique."]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"After setting up the connection, you can use Ray as usual in your code."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"customizing-ray-configuration",children:"Customizing Ray Configuration"}),"\n",(0,i.jsxs)(e.p,{children:["When using the ",(0,i.jsx)(e.code,{children:"start-ray.sh"})," script, you can customize the Ray configuration by setting these environment variables before running the script:"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"KAMIWAZA_NUM_CPUS"}),": Override the number of CPUs Ray will use"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"KAMIWAZA_NUM_GPUS"}),": Override the number of GPUs Ray will use"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"For example:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"export KAMIWAZA_NUM_CPUS=4\nexport KAMIWAZA_NUM_GPUS=1\n./start-ray.sh\n"})}),"\n",(0,i.jsx)(e.p,{children:"This will start Ray with 4 CPUs and 1 GPU, regardless of the system's actual hardware configuration. This can be useful for testing or when you want to limit Ray's resource usage."})]})}function u(n={}){const{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(h,{...n})}):h(n)}},8453:(n,e,t)=>{t.d(e,{R:()=>a,x:()=>o});var i=t(6540);const r={},s=i.createContext(r);function a(n){const e=i.useContext(s);return i.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:a(n.components),i.createElement(s.Provider,{value:e},n.children)}}}]);